#!/bin/sh

# Get list of files that will be pushed
CHANGED=$(git diff --name-only origin/master...HEAD 2>/dev/null || git diff --name-only HEAD~1)

# Check if backend files changed
if echo "$CHANGED" | grep -q "^backend/"; then
  echo "ğŸ”§ Backend changes detected - running backend tests..."
  cd backend && npm test
  cd ..
fi

# Check if frontend files changed
if echo "$CHANGED" | grep -q "^frontend/"; then
  echo "ğŸ¨ Frontend changes detected - running frontend tests..."
  cd frontend && npm test && npx vite build
fi

# If only docs/config changed, skip tests
if ! echo "$CHANGED" | grep -qE "^(backend|frontend)/"; then
  echo "ğŸ“ No code changes - skipping tests"
fi
