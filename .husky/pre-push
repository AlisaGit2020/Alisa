#!/bin/sh

# Get list of files that will be pushed
CHANGED=$(git diff --name-only origin/master...HEAD 2>/dev/null || git diff --name-only HEAD~1)

# Determine which areas have changes
HAS_BACKEND=$(echo "$CHANGED" | grep -c "^backend/" || true)
HAS_FRONTEND=$(echo "$CHANGED" | grep -c "^frontend/" || true)

# Run tests only for areas with changes
if [ "$HAS_BACKEND" -gt 0 ] && [ "$HAS_FRONTEND" -gt 0 ]; then
  echo "ğŸ”§ Backend and frontend changes detected - running all tests..."
  cd backend && npm test && cd ..
  cd frontend && npm test && npx vite build
elif [ "$HAS_BACKEND" -gt 0 ]; then
  echo "ğŸ”§ Backend changes detected - running backend tests..."
  cd backend && npm test
elif [ "$HAS_FRONTEND" -gt 0 ]; then
  echo "ğŸ¨ Frontend changes detected - running frontend tests..."
  cd frontend && npm test && npx vite build
else
  echo "ğŸ“ No backend/frontend changes - skipping tests"
fi
